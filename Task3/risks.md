## Проблемы и риски, которые связаны с планируемым ростом нагрузки

На текущий момент все взаимодействия системы с внешними системами страховых компаний являются синхронными, исходя 
из схемы (REST / SOAP / GraphQL). 

Ins-product-aggregator собирает результат обработки запросов ко всем внешним системам в один ответ. В случае, если он
делает это последовательно, то данная операция будет пропорционально расти по времени обработки при увеличении 
количества внешних интеграций, что приведет к возможным ошибкам таймаута на стороне потребителей (сервисов core-app 
и ins-comp-settlement), возможным ошибкам с "обрывом" активных соединений и потерей результатов ответа, так как запросы
обрабатываются достаточно продолжительное время.

Даже если учесть ситуацию, при которой запросы во внешние системы обрабатываются асинхронным клиентом "пачкой" на стороне
Ins-product-aggregator, то максимальное время ответа будет соответствовать максимальному времени ответа одной из 
интеграций. При этом, не имея собственной БД, мы в любом случае сталкиваемся с задержками ответов и ошибками со стороны
внешних интеграций. При увеличении количества внешних систем ситуация будет ухудшаться вплоть до невозможности
использования данного подхода к межсервисному взаимодействию.

В случае с получением данных об оформленных страховках из core-app сервисом ins-comp-settlement, то опять же, данных в
рамках одного синхронного запроса может передаваться достаточно много, что может привести к перечисленным выше проблемам,
особенно в условиях роста числа страховых компаний.

## Решение

Предлагается заменить текущую схему взаимодействия между сервисами core-app, ins-comp-settlement и ins-product-aggregator
по REST на Event Streaming, а также завести собственную базу для ins-product-aggregator. Данный сервис согласно своей логике,
например, по расписанию будет опрашивать внешние системы страховых компаний и получать данные по страховым продуктам и 
тарифам, затем сохранять себе в базу и транслировать через событие в топик сервисам core-app и ins-comp-settlement,
тем самым реализуя принцип CQRS. Также вместо синхронного получения сервисом ins-comp-settlement данных о заключенных
страховых договорах из сервиса core-app ежесуточно, реализуем поочередную передачу новых договоров через топик.

Данный подход увеличит отказоустойчивость, существенно сократит время получения данных из внешних систем пользователями.
Помимо всего следующим этапом можно внедрить паттерн outbox, который позволит исключить проблему "двойной записи" и
гарантирует согласованность данных: при получении данных из внешних систем или заключении договора в core-app 
в транзакции запишем событием в таблицу аутбокса, обработчик считает новые записи из нее и отправит в топик Kafka.
